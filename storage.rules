rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Publicly readable content
    match /public/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null; // Or more restrictive
    }

    // Photos for chefs, readable by anyone
    match /chef_photos/{chefId}/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null && (exists(/databases/(default)/documents/users/$(request.auth.uid)) && get(/databases/(default)/documents/users/$(request.auth.uid)).data.role in ['chef', 'admin']);
    }
    
    // Photos for dishes, readable by anyone
    match /dish_photos/{dishId}/{allPaths=**} {
        allow read: if true;
        allow write: if request.auth != null && (exists(/databases/(default)/documents/users/$(request.auth.uid)) && get(/databases/(default)/documents/users/$(request.auth.uid)).data.role in ['chef', 'admin']);
    }
  }
}
